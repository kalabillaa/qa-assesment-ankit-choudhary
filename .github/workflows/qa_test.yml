name: QA Test Suite

on: 
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  ui-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install Dependencies
        run: npm ci

      - name: Install Playwright Browsers
        run: npx playwright install

      - name: Run Playwright UI Tests
        run: npx playwright test --reporter=html || true

      - name: Upload UI Test Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ui-test-report
          path: playwright-report

      - name: Upload UI Test Screenshots
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: ui-test-screenshots
          path: tests/screenshots

      - name: Show UI Test Logs
        if: failure()
        run: cat playwright-report/**/*.txt || true

  api-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install Dependencies
        run: npm ci

      - name: Install Playwright Browsers
        run: npx playwright install

      - name: Run Playwright API Tests
        run: npx playwright test tests/api --reporter=html --headed=false || true

      - name: Upload API Test Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: api-test-report
          path: playwright-report

      - name: Show API Test Logs
        if: failure()
        run: cat playwright-report/**/*.txt || true